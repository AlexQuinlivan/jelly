#!/usr/bin/python3

import parser, sys

char_table = ''.join(sorted(set(''.join(map(chr,range(0, 128))) + parser.str_allchar)))

assert(len(char_table) <= 256)

for char in sys.argv[1]:
	if char == 'f':
		flag_file = True
		flag_utf8 = False
	elif char == 'u':
		flag_file = True
		flag_utf8 = True
	elif char == 'e':
		flag_file = False

if flag_file:
	with open(sys.argv[2], 'rb') as file:
		code = file.read()
	if flag_utf8:
		code = code.decode()
		for char in code:
			assert(char in char_table)
	else:
		code = ''.join([char_table[i] for i in code])
else:
	code = sys.argv[2]

args = tuple(map(parser.jelly.helper.try_eval, sys.argv[3:]))

for index in range(min(5, len(args))):
	parser.jelly.atoms['³⁴⁵⁶⁷'[index]].call = lambda literal = args[index]: literal

print(parser.jelly.variadic_chain(parser.parse_code(code)[-1], args), end = '')